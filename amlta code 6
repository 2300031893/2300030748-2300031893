const { useState } = React;

function MedicationManager() {
    const store = window.prescriptionStore();
    const { masterMedications, currentPrescription } = store;
    const [selectedMed, setSelectedMed] = useState('');

    const frequencyOptions = [
        'Once daily',
        'Twice daily',
        'Three times daily',
        'Four times daily',
        'As needed',
        'Before meals',
        'After meals',
        'At bedtime'
    ];

    return (
        <div className="form-group">
            <label>Medications *</label>
            <div className="instructions">
                <small>Add medications and specify dosage, frequency, and duration for each.</small>
            </div>
            
            <div style={{ display: 'flex', gap: '10px', marginBottom: '15px' }}>
                <select
                    value={selectedMed}
                    onChange={(e) => setSelectedMed(e.target.value)}
                    style={{ flex: 1 }}
                >
                    <option value="">Select medication to add...</option>
                    {masterMedications.map(med => (
                        <option key={med.id} value={med.id}>
                            {med.name} ({med.type})
                        </option>
                    ))}
                </select>
                <button
                    className="add-med-btn"
                    onClick={() => {
                        if (selectedMed) {
                            store.addMedication(selectedMed);
                            setSelectedMed('');
                        }
                    }}
                    disabled={!selectedMed}
                >
                    Add Medication
                </button>
            </div>

            <div className="medications-list">
                {currentPrescription.medications.map((med, index) => (
                    <div key={index} className="medication-item">
                        <div className="medication-header">
                            <span className="medication-name">{med.name} ({med.type})</span>
                            <button
                                className="remove-btn"
                                onClick={() => store.removeMedication(index)}
                            >
                                Remove
                            </button>
                        </div>
                        <div className="medication-fields">
                            <div>
                                <label>Dosage *</label>
                                <input
                                    type="text"
                                    placeholder="e.g., 500mg, 10ml"
                                    value={med.dosage}
                                    onChange={(e) => store.updateMedication(index, 'dosage', e.target.value)}
                                />
                            </div>
                            <div>
                                <label>Frequency *</label>
                                <select
                                    value={med.frequency}
                                    onChange={(e) => store.updateMedication(index, 'frequency', e.target.value)}
                                >
                                    {frequencyOptions.map(freq => (
                                        <option key={freq} value={freq}>{freq}</option>
                                    ))}
                                </select>
                            </div>
                            <div>
                                <label>Duration *</label>
                                <input
                                    type="text"
                                    placeholder="e.g., 7 days, 2 weeks"
                                    value={med.duration}
                                    onChange={(e) => store.updateMedication(index, 'duration', e.target.value)}
                                />
                            </div>
                            <div>
                                <label>Special Instructions</label>
                                <input
                                    type="text"
                                    placeholder="e.g., Take with food"
                                    value={med.instructions}
                                    onChange={(e) => store.updateMedication(index, 'instructions', e.target.value)}
                                />
                            </div>
                        </div>
                    </div>
                ))}
            </div>

            {currentPrescription.medications.length === 0 && (
                <div style={{ textAlign: 'center', padding: '20px', color: '#7f8c8d' }}>
                    No medications added yet. Use the dropdown above to add medications.
                </div>
            )}
        </div>
    );
}
